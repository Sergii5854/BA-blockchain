(function(t){function e(e){for(var a,s,o=e[0],c=e[1],l=e[2],h=0,f=[];h<o.length;h++)s=o[h],i[s]&&f.push(i[s][0]),i[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(f.length)f.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(a=!1)}a&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var a={},i={app:0},r=[];function s(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=a,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(n,a,function(e){return t[e]}.bind(null,a));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/BA-blockchain/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var a=n("64a9"),i=n.n(a);i.a},1:function(t,e){},"13d6":function(t,e,n){"use strict";var a=n("d93b"),i=n.n(a);i.a},1821:function(t,e,n){t.exports=n.p+"img/blockchain.6379f80d.png"},"18e3":function(t,e,n){"use strict";var a=n("d4f0"),i=n.n(a);i.a},"1a06":function(t,e,n){"use strict";var a=n("4a89"),i=n.n(a);i.a},"1a2e":function(t,e,n){"use strict";var a=n("6736"),i=n.n(a);i.a},2:function(t,e){},3:function(t,e){},3576:function(t,e,n){"use strict";var a=n("f90a"),i=n.n(a);i.a},4:function(t,e){},"4a89":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var a=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("Header")],1)},r=[],s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-navbar",{attrs:{toggleable:"md",type:"dark",variant:"success"}},[a("b-navbar-toggle",{attrs:{target:"nav_collapse"}}),a("b-navbar",{attrs:{variant:"faded",type:"light"}},[a("b-navbar-brand",{attrs:{href:"/",to:"/"}},[a("img",{staticClass:"d-inline-block align-top",attrs:{src:n("1821"),height:"30",alt:"Brand"}})])],1),a("b-collapse",{attrs:{"is-nav":"",id:"nav_collapse"}},[a("b-navbar-nav",[a("li",{staticClass:"nav-item"},[a("router-link",{staticClass:"nav-link",attrs:{to:"/hw2"}},[t._v("HW 2")])],1),a("li",{staticClass:"nav-item"},[a("router-link",{staticClass:"nav-link",attrs:{to:"/hw3#mainTURN"}},[t._v("HW 3")])],1)]),a("b-navbar-nav",{staticClass:"ml-auto"},[a("li",{staticClass:"nav-item"},[a("router-link",{staticClass:"nav-link",attrs:{to:"/users"}},[t._v("Users")])],1)])],1)],1),a("router-view")],1)},o=[],c={name:"Header"},l=c,u=(n("a75d"),n("2877")),h=Object(u["a"])(l,s,o,!1,null,"45c5e778",null);h.options.__file="Header.vue";var f=h.exports,d={name:"app",components:{Header:f}},v=d,m=(n("034f"),Object(u["a"])(v,i,r,!1,null,null,null));m.options.__file="App.vue";var p=m.exports,b=n("8c4f"),g=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},y=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h1",[t._v("Home")])])}],w={name:"Home"},_=w,k=(n("1a06"),Object(u["a"])(_,g,y,!1,null,"5b0445e4",null));k.options.__file="Home.vue";var C=k.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Hero"),n("div",{staticClass:"container"},[n("div",{staticClass:"row"},[n("br"),n("div",{staticClass:"col-sm-12"},[n("h2",[t._v("With signature")]),n("button",{staticClass:"btn btn-md btn-success",on:{click:t.addTx}},[t._v("Add Transition\n                ")])]),n("br"),t.blockChain.chain?n("div",{staticClass:"text-center"},[n("b-table",{attrs:{stacked:"md","show-empty":"",items:t.blockChain.chain},scopedSlots:t._u([{key:"transactions",fn:function(e){return[n("b-row",{staticClass:"mb-2"},[n("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[n("b",[t._v(" From:")])]),e.value[0].from?n("b-col",[t._v(t._s(e.value[0].from))]):n("b-col",[t._v("0")])],1),n("b-row",{staticClass:"mb-2"},[n("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[n("b",[t._v(" To:")])]),n("b-col",[t._v(t._s(e.value[0].to))])],1),n("b-row",{staticClass:"mb-2"},[n("b-col",{staticClass:"text-sm-right",attrs:{sm:"3"}},[n("b",[t._v(" Amount:")])]),n("b-col",[t._v(t._s(e.value[0].amount))])],1)]}},{key:"show_details",fn:function(e){return[n("b-button",{staticClass:"mr-2",attrs:{size:"sm"},on:{click:function(t){return t.stopPropagation(),e.toggleDetails(t)}}},[t._v("\n                            "+t._s(e.detailsShowing?"Hide":"Show")+" Details\n                        ")])]}},{key:"row-details",fn:function(e){return[n("b-card",[e.transactions?n("b-table",{staticClass:"col-md-12",attrs:{striped:"",hover:"",items:e.transactions}}):t._e(),n("b-button",{attrs:{size:"sm"},on:{click:e.toggleDetails}},[t._v("Hide Details")])],1)]}}])})],1):t._e()])])],1)},O=[],P=n("b9a8"),T=n.n(P),S=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},W=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"hero-wrap"},[n("div",{staticClass:"hero-background"})])}],H={name:"Hero"},j=H,M=(n("13d6"),Object(u["a"])(j,S,W,!1,null,"48e98fd0",null));M.options.__file="hero.vue";var E=M.exports,A=(n("14b9"),n("f559"),n("96cf"),n("1da1")),B=(n("ac4d"),n("8a81"),n("ac6a"),n("d4ec")),F=n("bee2"),R=n("0b26"),N=n.n(R),K=n("7409"),$=n.n(K),D=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Object(B["a"])(this,t),this.timestamp=e,this.transactions=n,this.previousHash=a,this.hash=this.calculateHash(),this.nonce=0}return Object(F["a"])(t,[{key:"calculateHash",value:function(){return N()(this.index+this.previousHash+this.timestamp+JSON.stringify(this.transactions)+this.nonce)}},{key:"hasValidTransaction",value:function(){var t=!0,e=!1,n=void 0;try{for(var a,i=this.transactions[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var r=a.value;if(!r.isValid())return!1}}catch(s){e=!0,n=s}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}return!1}},{key:"addTransaction",value:function(t){if(!t.isValid)throw new Error("Invalid transaction");this.transactions.push(t)}},{key:"mineBlock",value:function(){var t=Object(A["a"])(regeneratorRuntime.mark(function t(e){var n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t){while(!n.hash.startsWith("0".repeat(e)))n.nonce+=$()(1),n.nonce%5e3===0&&console.log(n.nonce),n.hash=n.calculateHash();return t(n.hash)}));case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}(),J=function(){function t(e,n,a,i){Object(B["a"])(this,t),this.from=e,this.to=n,this.amount=a,this.signature=i}return Object(F["a"])(t,[{key:"calculateHash",value:function(){return N()(this.from+this.to+this.amount)}},{key:"sign",value:function(){var t=Object(A["a"])(regeneratorRuntime.mark(function t(e){var n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,a){e.getPublic("hex")!==n.from&&a("You cannot sign Transaction for other wallets");var i=n.calculateHash(),r=e.sign(i,"base64");return n.signature=r.toDER("hex"),t(n.signature)}));case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"isValid",value:function(){if(null===this.from)return!0;if(!this.signature||0===this.signature.length)throw new Error("No signature in this transaction");var t=new T.a("secp256k1"),e=t.keyFromPublic(this.from,"hex");return e.verify(this.calculateHash(),this.signature)}}]),t}(),U=1e3,V=function(){function t(){Object(B["a"])(this,t),this.chain=[this.createGenesisBlock()],this.difficulty=2,this.pendingTransactions=[],this.miningReward=1}return Object(F["a"])(t,[{key:"createGenesisBlock",value:function(){return new D("15/11/2018",[{from:"GenesisBlock"}],"0")}},{key:"getLastBlock",value:function(){return this.chain[this.chain.length-1]}},{key:"addBlock",value:function(t){t.previousHash=this.getLastBlock().hash,t.mineBlock(this.difficulty),this.chain.push(t)}},{key:"mineTransaction",value:function(t){var e=new J(null,t,this.miningReward);this.pendingTransactions.push(e);var n=new D(Date.now(),this.pendingTransactions,this.getLastBlock().hash);n.mineBlock(this.difficulty),console.log("block successfully mined"),this.chain.push(n),this.pendingTransactions=[]}},{key:"addChainTransaction",value:function(t){if(!t.from||!t.to)throw new Error("transaction must include from and to  Addresses");if(!t.isValid())throw new Error("Cannot add invalid transaction to Chain ");this.pendingTransactions.push(t)}},{key:"getBalanceOfAddress",value:function(t){var e=0,n=!0,a=!1,i=void 0;try{for(var r,s=this.chain[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var o=r.value,c=!0,l=!1,u=void 0;try{for(var h,f=o.transactions[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var d=h.value;d.from===t&&(e-=d.amount),d.to===t&&(e+=d.amount)}}catch(v){l=!0,u=v}finally{try{c||null==f.return||f.return()}finally{if(l)throw u}}}}catch(v){a=!0,i=v}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return e}},{key:"isValid",value:function(){for(var t=1;t<this.chain.length;t++){var e=this.chain[t],n=this.chain[t-1];if(!e.hasValidTransaction())return!1;if(e.hash!==e.calculateHash())return!1;if(e.previousHash!==n.hash)return!1}return!0}},{key:"mineBlock",value:function(){var t=Object(A["a"])(regeneratorRuntime.mark(function t(e){var n,a,i,r=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=performance.now(),a=new D,e.forEach(function(t){a.addTransaction(t)}),i=this.getLastBlock(),a.previousHash=i.hash,t.abrupt("return",a.mineBlock(this.difficulty).then(function(){var t=performance.now(),e=t-n;return console.log({time:e,difficulty:r.difficulty}),e<U?r.difficulty+=1:r.difficulty-=1,r.chain.push(a),r.chain}));case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}();n("6b54"),n("a481");function L(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function G(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return Math.random().toString().replace("0.","").slice(0,t)}var I={name:"HW2",data:function(){return{blockChain:new V,index:0,myKey:this.getMyKey(),myWalletAddress:this.getMyWalletAddress()}},components:{Hero:E},methods:{getMyKey:function(){var t=new T.a("secp256k1");return t.keyFromPrivate("47c38c05301db390963a0807f1ae35db3248147a0abffa20f0a12ab8cdd46e15")},getMyWalletAddress:function(){return this.getMyKey().getPublic("hex")},addTransition:function(){var t=G(),e=G(),n=L(0,100),a=new Date,i=new J(t,e,n),r=new D(++this.index,a,i);this.addBlock2Chain(r)},addBlock2Chain:function(t){this.blockChain.addBlock(t)},addTx:function(){var t=G(),e=L(0,100),n=new J(this.myWalletAddress,t,e);n.sign(this.myKey),this.blockChain.addChainTransaction(n),this.blockChain.mineTransaction(this.myWalletAddress)}}},z=I,q=(n("3576"),Object(u["a"])(z,x,O,!1,null,"0f543810",null));q.options.__file="HW2.vue";var Y=q.exports,Q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-md-12"},[n("h1",{},[t._v("WEbRTC TURN ")]),n("c-node",{attrs:{wallet:t.myWallet,chain:t.chain},on:{mine:t.onMine}})],1)])])},X=[],Z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("br"),n("div",{staticClass:"connect"},[t.isConnect?n("div",{staticClass:"connect--true connect-indicator connect-indicator-true"},[t._v("\n            Connect\n        ")]):n("div",{staticClass:"connect--false "},[n("h2",[t._v("WebRTC Connect Section")]),t._m(0),n("hr"),n("div",{staticClass:"connect-indicator connect-indicator-false"},[t._v("\n                NOT Connect\n            ")]),t.isOffer?n("div",{staticClass:"offer"},[n("h3",[t._v("Please, copy this OFFER and past in opening tab")]),n("textarea",{attrs:{name:"offer",rows:"4"}},[t._v(t._s(t.offer))])]):t._e(),t.isAnswer?n("div",{staticClass:"answer"},[n("h3",[t._v("Please, copy this ANSWER and past in previous tab")]),n("textarea",{attrs:{name:"answer",rows:"4"}},[t._v(t._s(t.answer))])]):t._e(),n("form",{ref:"peerForm",attrs:{model:t.peerForm}},[t.isOffer?n("h3",[t._v("Please, Insert here answer ")]):n("h3",[t._v("Please, Insert here offer ")]),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.peerForm.inner,expression:"peerForm.inner"}],attrs:{size:"sm",type:"text"},domProps:{value:t.peerForm.inner},on:{input:function(e){e.target.composing||t.$set(t.peerForm,"inner",e.target.value)}}}),n("button",{attrs:{disabled:t.isMining,type:"primary"},on:{click:function(e){e.preventDefault(),t.submitPeerForm("peerForm")}}},[t._v("\n                    Submit\n                ")]),n("button",{on:{click:function(e){e.preventDefault(),t.resetForm("peerForm")}}},[t._v("\n                    Reset\n                ")])])])]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isConnect,expression:"isConnect"}]},[n("h2",[t._v("WebRTC Transaction Section")]),n("button",{staticClass:"btn btn-md btn-success",on:{click:t.addTx}},[t._v("Add Transition\n        ")]),n("div",{staticClass:"text-left"},[n("pre",[t._v("                "+t._s(t.chain)+"\n            ")])])])])},tt=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("h3",[n("a",{attrs:{href:"/hw3",target:"_blank"}},[t._v("Click here")]),t._v("\n                To open new tab in browser and create WebRTC connection  ")])}],et=new T.a("secp256k1"),nt=function(){function t(e){Object(B["a"])(this,t),this.chain=e,this.myWallet=et.genKeyPair()}return Object(F["a"])(t,[{key:"publicKey",value:function(){return this.myWallet.getPublic("hex")}},{key:"wallet",value:function(){return this.myWallet}}]),t}(),at=n("051a"),it=n.n(at),rt={name:"Node",props:{chain:{type:Object,required:!0}},data:function(){return{wordState:{},peer:{},node:{},isMining:!1,isConnect:!1,isOffer:!1,offer:{},isAnswer:!1,answer:{},myKey:this.getMyKey(),myWalletAddress:this.getMyWalletAddress(),peerForm:{inner:""}}},created:function(){this.node=new nt(this.chain),this.transactionForm=this.node.publicKey(),this.initPeer()},methods:{initPeer:function(){this.peer=new it.a({initiator:"#mainTURN"===location.hash,trickle:!1}),this.peer.on("error",this.onPeerError),this.peer.on("signal",this.onPeerSignal),this.peer.on("connect",this.onPeerConnect),this.peer.on("data",this.onPeerData)},onPeerError:function(t){console.log("peer error",t)},onPeerSignal:function(t){var e=JSON.stringify(t);"offer"===t.type&&(this.isOffer=!0,this.offer=e),"answer"===t.type&&(this.isAnswer=!0,this.answer=e),console.log("SIGNAL",e)},onPeerConnect:function(){this.isConnect=!0,console.log("CONNECT")},onPeerData:function(t){var e=this;console.log("data: "+t);var n=new J(JSON.parse(t));this.isMining=!0,this.node.chain.mineBlock([n]).then(function(t){console.log("blocks",t),e.isMining=!1,e.updateWorldState(t[t.length-1])})},updateWorldState:function(t){console.log("block",t);var e=t.transactions;console.log(t.transactions);for(var n=0;n<e.length;n++){console.log(e[n]);var a=e[n],i=a.from,r=a.to,s=a.amount;this.worldState[i]?this.worldState[i]-=s:this.worldState[i]=-s,this.worldState[r]?this.worldState[r]+=s:this.worldState[r]=+s}},getMyKey:function(){var t=new T.a("secp256k1");return t.keyFromPrivate("043858f05681eb5ab8b5e01e3714a2f930b60338733824211aâ€¦cdf136a69e838cf980208a69f36ca2be8e8b7260edb6daff6")},getMyWalletAddress:function(){return this.getMyKey().getPublic("hex")},addTx:function(){var t=this;this.isMining=!0;var e=G(),n=L(0,100),a=new J(this.myWalletAddress,e,n);a.sign(this.myKey).then(function(){t.peer.send(JSON.stringify(a)),t.node.chain.mineBlock([a]).then(function(e){console.log("blocks",e),t.isMining=!1,t.updateWorldState(e[e.length-1])})}).catch(function(e){console.log("submit",e),t.isMining=!1})},submitPeerForm:function(t){this.peer.signal(JSON.parse(this.peerForm.inner)),console.log("error submit!!")}}},st=rt,ot=(n("7800"),Object(u["a"])(st,Z,tt,!1,null,"df63cf84",null));ot.options.__file="Node.vue";var ct=ot.exports,lt=new T.a("secp256k1"),ut={name:"HW3",components:{"c-node":ct},data:function(){return{myWallet:{},wallets:[],chain:{}}},created:function(){this.chain=new V,this.generateWallet(),this.generateWallet()},methods:{generateWallet:function(){var t=lt.genKeyPair();this.wallets.push(t)},onMine:function(){}}},ht=ut,ft=(n("1a2e"),Object(u["a"])(ht,Q,X,!1,null,"74b0425a",null));ft.options.__file="HW3.vue";var dt=ft.exports,vt=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},mt=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h1",[t._v("Users Page")])])}],pt={name:"Users"},bt=pt,gt=(n("18e3"),Object(u["a"])(bt,vt,mt,!1,null,"0aeebb74",null));gt.options.__file="Users.vue";var yt=gt.exports;a["a"].use(b["a"]);var wt=new b["a"]({mode:"history",routes:[{path:"/",component:C},{path:"/hw2",component:Y},{path:"/hw3",component:dt},{path:"/users",component:yt}]}),_t=n("9f7b");n("f9e3"),n("2dd8");a["a"].config.productionTip=!1,a["a"].use(_t["a"]),new a["a"]({router:wt,render:function(t){return t(p)}}).$mount("#app")},"64a9":function(t,e,n){},6736:function(t,e,n){},7800:function(t,e,n){"use strict";var a=n("8056"),i=n.n(a);i.a},"7cb6":function(t,e,n){},8056:function(t,e,n){},a75d:function(t,e,n){"use strict";var a=n("7cb6"),i=n.n(a);i.a},d4f0:function(t,e,n){},d93b:function(t,e,n){},f90a:function(t,e,n){}});
//# sourceMappingURL=app.46dd34cb.js.map